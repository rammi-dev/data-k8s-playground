@startuml
title <size:18>L1 - Kontekst systemu: Data Lakehouse Platform</size>

set separator none
top to bottom direction
skinparam ranksep 60
skinparam nodesep 30
hide stereotype

<style>
  root {
    BackgroundColor: #ffffff;
    FontColor: #444444;
  }
  // Element,Person
  .Element-RWxlbWVudCxQZXJzb24= {
    BackgroundColor: #4dabf7;
    LineColor: #3577ac;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 16;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 700;
  }
  // Element,Software System
  .Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0= {
    BackgroundColor: #1971c2;
    LineColor: #114f87;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 16;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 700;
  }
  // Element,Software System,External
  .Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw= {
    BackgroundColor: #868e96;
    LineColor: #5d6369;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #ffffff;
    FontSize: 16;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 700;
  }
  // Relationship
  .Relationship-UmVsYXRpb25zaGlw {
    LineThickness: 2;
    LineStyle: 10-10;
    LineColor: #444444;
    FontColor: #444444;
    FontSize: 16;
  }
</style>

person "==Data Engineer\n<size:12>[Person]</size>\n\nProjektuje i uruchamia potoki ETL, zarządza zbiorami danych i jakością danych" <<Element-RWxlbWVudCxQZXJzb24=>> as DataEngineer
rectangle "==LDAP / Active Directory\n<size:12>[Software System]</size>\n\nKatalog korporacyjny; Keycloak federuje do niego, niektóre komponenty łączą się bezpośrednio" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as LDAPActiveDirectory
rectangle "==Power BI\n<size:12>[Software System]</size>\n\nKorporacyjna platforma BI Microsoft (zewnętrzna, desktopy korporacyjne)" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as PowerBI
rectangle "==External Airflow (MSPD)\n<size:12>[Software System]</size>\n\nZewnętrzna instancja Airflow, która aktualnie kopiuje (planowane) pliki z Legacy MinIO do MinIO. Kafka Legacy wykorzystywana do synchronizacji plików z Airflow Legacy." <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as ExternalAirflowMSPD
rectangle "==External Data Sources\n<size:12>[Software System]</size>\n\nPliki z magazynu kompatybilnego z S3 (CSV/Parquet)" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as ExternalDataSources
rectangle "==GitOps / CI-CD (planned)\n<size:12>[Software System]</size>\n\nPotoki ArgoCD / Tekton do wdrożeń na OCP" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as GitOpsCICDplanned
rectangle "==Monitoring Platform\n<size:12>[Software System]</size>\n\nZewnętrzny stos obserwowalności: zbieranie metryk, agregacja logów, dashboardy, alerty. Odpytuje endpointy /metrics i zbiera logi ze wszystkich kontenerów platformy." <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as MonitoringPlatform
rectangle "==Data Lakehouse Platform\n<size:12>[Software System]</size>\n\nZintegrowana platforma analityczna wdrożona na OpenShift, zbudowana wokół otwartych formatów danych (Apache Iceberg na MinIO). Zapewnia zunifikowaną federację zapytań SQL (Dremio), rozproszone obliczenia wsadowe (Spark), orkiestrację przepływów pracy (Airflow), interaktywne notebooki (JupyterHub) i dashboardy BI (Superset/PowerBI). Wszystkie komponenty użytkownika uwierzytelniają się przez Keycloak OIDC (planowane); Dremio federuje użytkowników bezpośrednio z LDAP/AD (aktualnie używane do uwierzytelniania). Obserwowalność zapewniona przez zewnętrzną Platformę Monitorowania." <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0=>> as DataLakehousePlatform
person "==Data Analyst / BI User\n<size:12>[Person]</size>\n\nOdpytuje dane przez Dremio SQL, korzysta z notebooków Jupyter, tworzy dashboardy Superset, generuje raporty" <<Element-RWxlbWVudCxQZXJzb24=>> as DataAnalystBIUser
person "==Data Scientist\n<size:12>[Person]</size>\n\nProwadzi eksperymenty w notebookach JupyterHub, wykorzystuje PySpark do zadań ML" <<Element-RWxlbWVudCxQZXJzb24=>> as DataScientist
person "==BI Developer\n<size:12>[Person]</size>\n\nTworzy raporty i dashboardy korporacyjne w Power BI/Superset" <<Element-RWxlbWVudCxQZXJzb24=>> as BIDeveloper
person "==Platform Admin\n<size:12>[Person]</size>\n\nZarządza klastrem OCP, wdraża komponenty, monitoruje stan systemu" <<Element-RWxlbWVudCxQZXJzb24=>> as PlatformAdmin
rectangle "==MinIO\n<size:12>[Software System]</size>\n\nMagazyn obiektowy kompatybilny z S3 dla tabel Iceberg, danych rozproszonych i kopii zapasowych" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as MinIO
rectangle "==MinIO (Legacy)\n<size:12>[Software System]</size>\n\nIstniejący starszy magazyn obiektowy z danymi historycznymi. Dane są aktualnie kopiowane do MinIO przez zewnętrzną instancję Airflow." <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as MinIOLegacy
rectangle "==Kafka (Legacy)\n<size:12>[Software System]</size>\n\nZewnętrzny streaming zdarzeń; publikuje powiadomienia o plikach z MinIO Legacy. OBECNIE NIEDOSTĘPNY z platformy Lakehouse — wymaga wdrożenia rozwiązania sieciowego/integracyjnego. Zależy od ostatecznej decyzji projektowej." <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as KafkaLegacy
rectangle "==Keycloak (planned)\n<size:12>[Software System]</size>\n\nZewnętrzny współdzielony SSO / broker tożsamości (dostawca OIDC)" <<Element-RWxlbWVudCxTb2Z0d2FyZSBTeXN0ZW0sRXh0ZXJuYWw=>> as Keycloakplanned

DataEngineer --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Projektuje potoki ETL, zarządza zbiorami danych\n<size:12>[HTTPS]</size>"
DataAnalystBIUser --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Odpytuje dane, tworzy dashboardy\n<size:12>[HTTPS]</size>"
DataScientist --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Uruchamia notebooki i eksperymenty\n<size:12>[HTTPS]</size>"
BIDeveloper --> PowerBI <<Relationship-UmVsYXRpb25zaGlw>> : "Tworzy raporty i dashboardy\n<size:12>[Desktop]</size>"
PlatformAdmin --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Zarządza klastrem, monitoruje stan\n<size:12>[HTTPS]</size>"
PlatformAdmin --> GitOpsCICDplanned <<Relationship-UmVsYXRpb25zaGlw>> : "Zarządza wdrożeniami\n<size:12>[HTTPS]</size>"
PowerBI --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Odpytuje Dremio do raportów\n<size:12>[ODBC/JDBC]</size>"
DataLakehousePlatform --> MinIO <<Relationship-UmVsYXRpb25zaGlw>> : "Przechowuje tabele Iceberg, dane rozproszone, kopie zapasowe\n<size:12>[S3 API]</size>"
DataLakehousePlatform --> Keycloakplanned <<Relationship-UmVsYXRpb25zaGlw>> : "Uwierzytelnia użytkowników przez SSO\n<size:12>[OIDC]</size>"
DataLakehousePlatform --> LDAPActiveDirectory <<Relationship-UmVsYXRpb25zaGlw>> : "Federuje użytkowników bezpośrednio\n<size:12>[LDAP/LDAPS]</size>"
ExternalAirflowMSPD --> MinIOLegacy <<Relationship-UmVsYXRpb25zaGlw>> : "Odczytuje historyczne pliki danych\n<size:12>[S3 API]</size>"
ExternalAirflowMSPD --> MinIO <<Relationship-UmVsYXRpb25zaGlw>> : "Kopiuje pliki do nowego magazynu\n<size:12>[S3 API]</size>"
ExternalDataSources --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Dostarcza dane do zasilania\n<size:12>[S3 API]</size>"
GitOpsCICDplanned --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Wdraża charty Helm na OCP\n<size:12>[K8s API]</size>"
PlatformAdmin --> MonitoringPlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Przegląda dashboardy, alerty\n<size:12>[HTTPS]</size>"
MonitoringPlatform --> DataLakehousePlatform <<Relationship-UmVsYXRpb25zaGlw>> : "Zbiera metryki i logi\n<size:12>[Prometheus/Log forwarding]</size>"

@enduml